(()=>{"use strict";var t,e,n,a,r,i,s,l;function o(t){return new Date(t.published.getTime()+15984e6)}function d(t){return Math.max.apply(null,Object.keys(t).map(function(e){return t[e]}))}function c(t){if(void 0===n[t.name]){var r=0===Object.keys(n).length?-a:d(n);n[t.name]=r+a}return"translate("+e(t.published)+", "+n[t.name]+")"}function u(n,a){var r;for(a++;a<t.length&&!(t[a].name===n.name||t[a].name.match(/^rfc/));a++);return e(r=n.name.match(/^draft-/)?(r=a===t.length?o(n):t[a].published)>o(n)?o(n):r:a===t.length?new Date:t[a].published)-e(n.published)}function p(){d3.select("#doc-timeline svg .x.axis").call(i).selectAll("text").style("text-anchor","end").attr("transform","translate(-14, 2) rotate(-60)")}function h(){var a,o;n={},e=d3.scaleTime().domain([d3.min(t,function(t){return t.published}),d3.max(t,function(t){return t.published})]).range([r,s]),a=t.slice(0,-1),l=Date.now(),a[a.length-1].published>l&&a.push(new Date(l)),o=d3.timeFormat("%b %Y"),a=a.sort(function(t,e){return t.published-e.published}).map(function(t,n,a){if(0===n||e(t.published)>e(a[n-1].published)+12&&o(t.published)!==o(a[n-1].published))return t.published}).filter(function(t){return void 0!==t}),i=d3.axisBottom(e).tickValues(a).tickFormat(function(t){return t.getTime()<l?o(t):"Now"}),d3.select("#doc-timeline svg").attr("width",s).selectAll("g").data(t.slice(0,-1)).attr("transform",c).select("rect").attr("width",u),p()}d3.json("doc.json").then(function(i){if((t=i.rev_history).length){var l,f,m,g,b,x,v,w,y,k,B,j;t.forEach(function(t){t.published=new Date(t.published)}),t.push({name:"",rev:"",published:o(t[t.length-1])}),s=$("#doc-timeline").width(),a=parseFloat($("body").css("line-height")),(f=$("#doc-timeline")).addClass("my-3"),f.is(":empty")&&f.append("<svg></svg>"),(b=(g=(m=d3.select("#doc-timeline svg").attr("width",s)).append("defs")).append("linearGradient").attr("id","maskGradient")).append("stop").attr("offset",.9).attr("stop-color","white").attr("stop-opacity",1),b.append("stop").attr("offset",1).attr("stop-color","white").attr("stop-opacity",0),g.append("mask").attr("id","fade").attr("maskContentUnits","objectBoundingBox").append("rect").attr("height",1).attr("width",1).attr("fill","url(#maskGradient)"),x=t.map(function(t){return t.name}).filter(function(t,e,n){return n.indexOf(t)===e}),r=10+d3.max(x,function(t){var e,n=m.append("text");return n.attr("class","y axis").attr("transform","translate(0, "+-a+")"),n.text(t).each(function(){e=this.getBBox().width}).remove().remove(),e}),h(),v=[],x.forEach(function(e){v=v.concat(t.filter(function(t){return t.name===e}))}),t=v,(j=m.selectAll("g").data(t.slice(0,-1)).enter().append("g")).attr("class","bar").attr("transform",c),(w=j.append("a")).attr("xlink:href",function(t){return t.url}),w.append("rect").attr("height",a).attr("width",u).attr("class","btn").attr("type","button").attr("mask",function(t,n){if(t.name.match(/^draft-/)&&u(t,n)>=e(o(t))-e(t.published))return"url(#fade)"}),(y=j.append("text")).attr("x",3).attr("y",a/2),y.text(function(t){return t.rev}),k=d3.scalePoint().domain(x).range([0,d(n)+a]),B=d3.axisLeft(k).tickValues(x),m.append("g").attr("class","x axis").attr("transform","translate(0, "+(d(n)+a)+")"),p(),(j=m.append("g")).attr("class","y axis").attr("transform","translate(10, "+a/2+")"),j.call(B).selectAll("text").style("text-anchor","start"),d3.select(".x.axis").each(function(){l=this.getBBox().height}),m.attr("height",d(n)+a+l)}}),$(window).on({resize:function(){var t=$("#doc-timeline svg");t.remove(),s=$("#doc-timeline").width(),$("#doc-timeline").append(t),h()}})})();
//# sourceMappingURL=document_timeline.js.map
